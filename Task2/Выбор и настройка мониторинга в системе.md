# Выбор и настройка мониторинга в системе

## Анализ системы в контексте мониторинга

### Текущее состояние
Компания "Александрит" использует только Яндекс Метрику для отслеживания пользовательской активности на сайте. Однако с открытием API для внешних продавцов данные Яндекс Метрики перестали давать полную картину происходящего в системе.

### Архитектурные компоненты для мониторинга
1. **Онлайн-магазин** (Vue + Java Spring Boot) - B2C трафик
2. **CRM** (Vue + Java Spring Boot) - управление клиентами
3. **MES** (React + C#) - производственные процессы
4. **RabbitMQ** - интеграция между системами
5. **Базы данных** - PostgreSQL/MySQL на Yandex Cloud
6. **API** - внешние интеграции

## Мотивация

### Почему нужен мониторинг
1. **Бизнес-критичность**: Потеря заказов напрямую влияет на выручку
2. **Масштабирование**: Рост на 100 заказов в месяц требует контроля производительности
3. **Качество сервиса**: Жалобы клиентов на просроченные заказы
4. **Операционная эффективность**: Медленная работа MES снижает продуктивность операторов
5. **Конкурентное преимущество**: Надежность системы - ключевой фактор для B2B клиентов

### Что даст мониторинг компании
- **Проактивное выявление проблем** до их влияния на клиентов
- **Быстрая диагностика** инцидентов (снижение MTTR с часов до минут)
- **Обоснованные решения** по масштабированию инфраструктуры
- **Повышение качества сервиса** через контроль SLA
- **Снижение операционных расходов** через автоматизацию

## Выбор подхода к мониторингу

### Подходы по компонентам системы

#### 1. Онлайн-магазин и CRM (Java Spring Boot)
**Выбранный подход: RED + USE**
- **RED**: Rate (запросы/сек), Errors (ошибки), Duration (время ответа)
- **USE**: Utilization (CPU, память), Saturation (очереди), Errors (ошибки)

**Обоснование**: Веб-приложения требуют мониторинга пользовательского опыта (RED) и ресурсов (USE)

#### 2. MES (C# приложение)
**Выбранный подход: USE + Бизнес-метрики**
- **USE**: Utilization, Saturation, Errors
- **Бизнес-метрики**: Время расчета стоимости, количество заказов в обработке

**Обоснование**: MES - ресурсоемкое приложение, критично для бизнеса

#### 3. RabbitMQ
**Выбранный подход: USE + Четыре золотых сигнала**
- **USE**: Utilization, Saturation, Errors
- **Золотые сигналы**: Latency, Traffic, Errors, Saturation

**Обоснование**: Очереди сообщений критичны для интеграции, требуют специального мониторинга

#### 4. Базы данных
**Выбранный подход: USE + Database-специфичные метрики**
- **USE**: Utilization, Saturation, Errors
- **DB метрики**: Connections, Query performance, Lock waits

**Обоснование**: Базы данных - узкое место системы, требуют детального мониторинга

## Метрики для отслеживания

### 1. Метрики производительности (RED)

#### Rate (Скорость запросов)
**Зачем нужна**: Контроль нагрузки на систему
**Ярлыки**: 
- `service` (online-shop, crm, mes)
- `endpoint` (API endpoint)
- `method` (GET, POST, PUT, DELETE)

#### Errors (Ошибки)
**Зачем нужна**: Контроль качества сервиса
**Ярлыки**:
- `service` (online-shop, crm, mes)
- `error_type` (4xx, 5xx, timeout, exception)
- `endpoint` (API endpoint)

#### Duration (Время ответа)
**Зачем нужна**: Контроль производительности
**Ярлыки**:
- `service` (online-shop, crm, mes)
- `endpoint` (API endpoint)
- `percentile` (p50, p95, p99)

### 2. Метрики ресурсов (USE)

#### Utilization (Использование ресурсов)
**Зачем нужна**: Контроль загрузки серверов
**Ярлыки**:
- `service` (online-shop, crm, mes, database)
- `resource` (cpu, memory, disk, network)
- `instance` (server instance)

#### Saturation (Насыщенность)
**Зачем нужна**: Предотвращение перегрузки
**Ярлыки**:
- `service` (online-shop, crm, mes, database)
- `resource` (cpu_queue, memory_swap, disk_queue, connection_pool)

#### Errors (Ошибки ресурсов)
**Зачем нужна**: Контроль стабильности инфраструктуры
**Ярлыки**:
- `service` (online-shop, crm, mes, database)
- `error_type` (oom, disk_full, connection_failed)

### 3. Бизнес-метрики

#### Количество заказов
**Зачем нужна**: Контроль бизнес-процессов
**Ярлыки**:
- `status` (initiated, submitted, in_production, completed)
- `source` (online-shop, api)
- `time_period` (hour, day, week)

#### Время обработки заказа
**Зачем нужна**: Контроль SLA
**Ярлыки**:
- `stage` (price_calculation, manufacturing, packaging)
- `complexity` (simple, medium, complex)

#### Успешность расчетов стоимости
**Зачем нужна**: Контроль качества MES
**Ярлыки**:
- `model_complexity` (low, medium, high)
- `calculation_time` (fast, medium, slow)

### 4. Метрики интеграции

#### RabbitMQ метрики
**Зачем нужна**: Контроль интеграции между системами
**Ярлыки**:
- `queue` (order_queue, status_queue)
- `operation` (publish, consume, ack)

#### API метрики
**Зачем нужна**: Контроль внешних интеграций
**Ярлыки**:
- `client` (external_seller_id)
- `endpoint` (calculate_price, get_status)
- `rate_limit` (tier)

### 5. Дополнительные метрики

#### Метрики пользовательского опыта
- **Время загрузки страниц** (особенно MES)
- **Количество активных пользователей**
- **Конверсия** (от просмотра до заказа)

#### Метрики безопасности
- **Количество неудачных попыток входа**
- **Подозрительная активность**
- **Использование API ключей**
