# Архитектурное решение по кешированию

## Анализ системы

### Критичные проблемы производительности
1. **Медленная загрузка MES** - операторы жалуются на долгую прогрузку страниц
2. **Медленный расчет стоимости** - 2-3 минуты в среднем, до 30 минут для сложных моделей
3. **Рост нагрузки** - +100 заказов в месяц, один инстанс БД на запись/чтение

### Приоритетные элементы для кеширования
- **MES**: список заказов, статусы, конфигурации
- **CRM**: список клиентов, история заказов
- **Расчет стоимости**: результаты дорогих вычислений
- **Онлайн-магазин**: каталог товаров, цены

## Мотивация

Кеширование необходимо для решения критических проблем производительности системы "Александрит":

1. **Производительность MES** - медленная загрузка страниц и расчет стоимости (до 30 минут)
2. **Рост нагрузки** - +100 заказов в месяц при ограниченных ресурсах БД
3. **Пользовательский опыт** - недовольство операторов скоростью работы

**Ожидаемые результаты:**
- Ускорение загрузки MES в 5-10 раз
- Снижение нагрузки на БД на 70-80%
- Улучшение пользовательского опыта

## Предлагаемое решение

### Серверное кеширование с паттерном Cache-Aside

**Обоснование выбора серверного кеширования:**
- Безопасность чувствительных данных
- Контроль консистентности
- Масштабируемость системы

**Обоснование выбора Cache-Aside:**
- Простота внедрения в существующую архитектуру
- Полный контроль над логикой кеширования
- Надежность (приложение работает без кеша)
- Гибкость оптимизации

**Технологический стек:** Redis + Spring Cache (Java) + Memory Cache (C#)

## Диаграмма последовательности

[Диаграмма PlantUML: caching-sequence-diagram.puml]

Диаграмма показывает 4 сценария кеширования:
1. **Чтение списка заказов (кеш промах)** - запрос к БД и сохранение в кеш
2. **Чтение списка заказов (кеш попадание)** - возврат данных из кеша
3. **Изменение статуса заказа** - обновление БД и инвалидация кеша
4. **Расчет стоимости** - кеширование результатов дорогих вычислений

## Стратегия инвалидации кеша

### Комбинированная стратегия

**1. Временная инвалидация (TTL):**
- Список заказов: 5 минут
- Статусы заказов: 10 минут
- Конфигурации: 1 час

**2. Инвалидация по ключу:**
- При изменении заказа: удаление кеша заказа и списков
- При изменении клиента: удаление связанных данных
- При изменении конфигурации: очистка конфигурационных кешей

**3. Программная инвалидация:**
- При критических изменениях и ошибках
- При обновлении системы

**Обоснование:** Комбинированный подход обеспечивает гибкость, надежность и производительность для разных типов данных.

## Дополнительное задание: Сравнение решений

### Решение 1: Redis + Cache-Aside

**Описание:** Redis как централизованное хранилище кеша с паттерном Cache-Aside

**Плюсы:** Высокая производительность, масштабируемость, надежность, консистентность

**Минусы:** Дополнительная инфраструктура, сложность настройки кластера

### Решение 2: In-Memory Cache + Database

**Описание:** Локальный кеш в каждом приложении с синхронизацией через БД

**Плюсы:** Нет дополнительной инфраструктуры, быстрый доступ, низкая стоимость

**Минусы:** Проблемы с синхронизацией, ограниченная память, сложность масштабирования

### Сравнительная таблица

| Критерий | Redis + Cache-Aside | In-Memory Cache |
|----------|---------------------|-----------------|
| **Производительность** | Очень высокая | Высокая |
| **Масштабируемость** | Отличная | Ограниченная |
| **Надежность** | Высокая | Средняя |
| **Консистентность** | Высокая | Низкая |
| **Сложность поддержки** | Средняя | Высокая |

### Заключение

**Рекомендуется Redis + Cache-Aside** для системы "Александрит" из-за:
- Масштабируемости под растущие нагрузки (+100 заказов/месяц)
- Надежности и консистентности данных
- Подходящности для долгосрочного развития
